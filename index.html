<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Formular mit Datei- und E-Mail-Prüfung</title>

  <!-- jQuery & Parsley -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/parsleyjs"></script>
</head>
<body>

  <h2>Formular mit erweiterten Prüfungen</h2>

  <form id="meinFormular" data-parsley-validate novalidate enctype="multipart/form-data">

    <!-- Name -->
    <p>
      <label>Name (Text):
        <input type="text" name="name" required
          data-parsley-pattern="^[A-Za-zÄÖÜäöüß\\s]+$"
          data-parsley-pattern-message="Nur Buchstaben erlaubt.">
      </label>
    </p>

    <!-- E-Mail (mit bestimmten Domains) -->
    <p>
      <label>E-Mail:
        <input type="email" name="email" required
          data-parsley-pattern="^[a-zA-Z0-9._%+-]+@(gmail\\.com|gmx\\.at|gmx\\.de|outlook\\.com)$"
          data-parsley-pattern-message="Nur E-Mails von gmail.com, gmx.at, gmx.de oder outlook.com erlaubt.">
      </label>
    </p>

    <!-- Passwort -->
    <p>
      <label>Passwort:
        <input type="password" name="password" required
          minlength="7"
          data-parsley-strongpassword>
      </label>
    </p>

    <!-- Datei -->
    <p>
      <label>Wähle eine Datei (PDF, PNG oder JPG – max. 30 MB):
        <input type="file" name="file" required
          data-parsley-fileextension="pdf, png, jpg"
          data-parsley-maxfilesize="30">
      </label>
    </p>

    <p>
      <input type="reset" value="Zurücksetzen">
      <input type="submit" value="Absenden">
    </p>

  </form>

  <script>
    // ==================================================
    //  Validator für mehrere Dateiendungen (mit indexOf)
    // ==================================================
    window.Parsley.addValidator('fileextension', {
      validateString: function(value, requirement, parsleyInstance) {
        const file = parsleyInstance.$element[0].files[0];
        if (!file) return false;

        const extension = file.name.split('.').pop().toLowerCase();
        const allowed = requirement.toLowerCase();
        return allowed.indexOf(extension) !== -1;
      },
      messages: {
        de: 'Nur Dateien mit folgenden Endungen erlaubt: %s'
      }
    });

    // ==================================================
    //  Validator für maximale Dateigröße (in MB)
    // ==================================================
    window.Parsley.addValidator('maxfilesize', {
      validateString: function(value, requirement, parsleyInstance) {
        const file = parsleyInstance.$element[0].files[0];
        if (!file) return false;

        const maxBytes = requirement * 1024 * 1024;
        return file.size <= maxBytes;
      },
      messages: {
        de: 'Die Datei darf maximal %s MB groß sein.'
      }
    });

    // ==================================================
    //  Starker Passwort-Check
    // ==================================================
    window.Parsley.addValidator('strongpassword', {
      validateString: function(value) {
        const lowerValue = value.toLowerCase();
        const weakList = ['123456', 'password', 'passwort', 'abcdef', 'qwerty'];
        if (weakList.indexOf(lowerValue) !== -1) return false;

        // Mindestens 7 Zeichen + eine Zahl + ein Buchstabe
        return /^(?=.*[A-Za-z])(?=.*\\d).{7,}$/.test(value);
      },
      messages: {
        de: 'Passwort muss mindestens 7 Zeichen und Zahlen + Buchstaben enthalten.'
      }
    });

    // ==================================================
    //  Submit-Handler
    // ==================================================
    document.getElementById("meinFormular").addEventListener("submit", function(e) {
      e.preventDefault();

      if ($(this).parsley().isValid()) {
        alert("✅ Formular erfolgreich geprüft!");
      } else {
        alert("⚠️ Bitte überprüfe deine Eingaben!");
      }
    });
  </script>

</body>
</html>
